
<div id="commentDiv">


<title>
	评论
</title><meta content="width=device-width" name="viewport">
<div id="post_comm" class="post_comment">
    <h3 id="post_comment">发表评论</h3>
    
<form action="#" method="post" name="feedback" onsubmit="return false;">
          <input type="hidden" name="dopost" value="send" />
          <input type="hidden" name="comtype" value="comments">
          <input type="hidden" name="aid" value="{dede:field name="id"/}" />
          <input type="hidden" name="fid" id='feedbackfid' value="0" />
<input type="hidden" name="feedbacktype" value="feedback" />
			<input type="hidden" name="notuser" id="dcmp-submit-guest" />

                      
        <div class="add_comm">
        <textarea onfocus="this.value=''; this.onfocus=null;" class="ipt-txt" rows="5" cols="60" id="msg" name="msg">有您参与更精彩！</textarea><p></p>
        
        <div class="comm-con"><span>签名：</span><input type="text" onblur="if(this.value=='')this.value='匿名';" onfocus="if(this.value=='匿名')this.value='';" value="匿名" class="ipt-txt" size="36" id="commentNick" name="username">
              <span>验证码：</span>
              <input type="text" name="validate" size="4" maxlength="4" class="ipt-txt" style="text-transform:uppercase;width:100px;"/>
              <img src= "/include/vdimgck.php" id="validateimg" style="cursor:pointer" onclick="this.src=this.src+\'?\'" title="点击我更换图片" alt="点击我更换图片"  class="vdimg"/>
        </div>
 
        <input onClick='PostComment()' type="button" class="button" id="btnComment" value="发表评论" name="btnComment">
        <span id="commentMessage"></span>
    </div>
</form>    
    <div id="commentlist" class="comm_list">
    <h3><span class="icon2"></span>评论列表</h3>
    <ul id="ulcommentlist" class="list"> 
        
    <dd id='commetcontent'></dd>
    <a name="newcomment"></a>
    <dd id='commetcontentNew'></dd>
    </ul><ul id="LoadArticleReply" class="list"></ul></div>
</div>
<!--<script type="text/javascript" src="/dedemao/js/comment.js"></script>-->
</div>    


<!--
//由于评论载入时使用异步传输，因此必须在最后一步加载（DIGG和评论框须放在评论内容前面）
//如果一定需要提前的把myajax.SendGet改为myajax.SendGet2，但可能会引起页面阻滞
-->
<script language='javascript'>
    var aid= $('.blog-g-fixed').attr('aid');
function LoadCommets(page)
{
		var taget_obj = $('#commetcontent').text()
		var waithtml = "<div style='line-height:50px'><img src='{dede:global.cfg_cmsurl/}/images/loadinglit.gif' />评论加载中...</div>";
//		var myajax = new DedeAjax(taget_obj, true, true, '', 'x', waithtml);
//		myajax.SendGet2("{dede:global.cfg_phpurl /}/feedback_ajax.php?dopost=getlist&aid={dede:field.id/}&page="+page);
    $.ajax({url: '/plus/feedback_ajax.php?dopost=getlist&aid='+aid+'&page='+page,data: data,async: true,type: 'GET',success: function(data) {
        console.log(data)
    }});

}
function PostComment()
{
		 
		var f = document.feedback;
    var $msg = $('#msg');
		var msg = $msg.text();
		
		var nface = '6';
		var nfeedbacktype = 'feedback';
		var nvalidate = '';
		var nnotuser = '';
		var nusername = '';
		var npwd = '';
		var taget_obj = $('#commetcontentNew');
		var waithtml = "<div style='line-height:30px'><img src='{dede:global.cfg_cmsurl/}/images/loadinglit.gif' />正在发送中...</div>";
		if(msg.length < 10)
		{
			alert("请至少输入10个字！");
			return;
		}
		if(f.validate)
		{
			if(f.validate.value==='') {
				alert("请填写验证码！");
				return;
			}
			else {
				nvalidate = f.validate.value;
			}
		}
		if(msg.length > 500)
		{
			alert("你的评论是不是太长了？请填写500字以内的评论。");
			return;
		}
		if(f.feedbacktype) {
			for(var i=0; i < f.feedbacktype.length; i++)
				if(f.feedbacktype[i].checked) nfeedbacktype = f.feedbacktype[i].value;
		}
		location.href="#newcomment";

		if(f.notuser.checked) nnotuser = '1';
		if(f.username) nusername = f.username.value;
		if(f.pwd) npwd = f.pwd.value;
		if(f.msg) msg = f.msg.value;
		document.getElementById("msg").value= '';
		$msg.text('')
		
		var myajax = new DedeAjax(taget_obj, false, true, '', '', waithtml);
		myajax.sendlang = '{dede:global.cfg_soft_lang/}';
		myajax.AddKeyN('dopost', 'send');
		myajax.AddKeyN('aid', '{dede:field.id/}');
		myajax.AddKeyN('fid', f.fid.value);
		myajax.AddKeyN('face', nface);
		myajax.AddKeyN('feedbacktype', nfeedbacktype);
		myajax.AddKeyN('validate', nvalidate);
		myajax.AddKeyN('notuser', nnotuser);
		myajax.AddKeyN('username', nusername);
		myajax.AddKeyN('pwd', npwd);
		myajax.AddKeyN('msg', msg);
		myajax.SendPost2('{dede:global.cfg_phpurl/}/feedback_ajax.php');
		//msg = '';
		CKEDITOR.instances.msg.setData('');
		document.getElementById("msg").setData('');
		document.getElementById("msg").value = "";
		
		//taget_obj.removeAttribute('id');
		f.fid.value = 0;
		if(f.validate)
		{
			if($('#validateimg')) $('#validateimg').attr('src',"/plus/include/vdimgck.php?"+f.validate.value) ;
			f.validate.value = '';
		}
		
		
}
LoadCommets(1);
</script>
<!-- //评论内容区结束 -->